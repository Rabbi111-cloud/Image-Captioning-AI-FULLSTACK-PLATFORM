import gradio as gr
from PIL import Image
import requests
import io

# Replace this with your deployed backend API URL
API_URL = "https://your-backend-api-url/caption"

def generate_caption(image):
    # Convert the PIL image to bytes instead of saving to disk
    img_bytes = io.BytesIO()
    image.save(img_bytes, format="JPEG")
    img_bytes.seek(0)

    files = {"file": ("image.jpg", img_bytes, "image/jpeg")}
    
    try:
        response = requests.post(API_URL, files=files, timeout=40)
        response.raise_for_status()
        return response.json().get("caption", "No caption returned.")
    except Exception as e:
        return f"Error: {str(e)}"

# Build the Gradio interface
iface = gr.Interface(
    fn=generate_caption,
    inputs=gr.Image(type="pil"),
    outputs="text",
    title="AI Image Captioning (Frontend Interface)",
    description="Upload an image and receive a caption generated by the backend API model."
)

# Run the UI
iface.launch()
